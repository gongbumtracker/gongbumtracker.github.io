<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공범 추적기 (Gongbum Tracker)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #333;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1rem;
            color: #666;
            font-weight: 400;
        }

        /* User Selection Area */
        .user-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .user-btn {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .user-btn:hover {
            border-color: #333;
            background: #f0f0f0;
        }

        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 8px 16px;
            background: #666;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .back-btn:hover {
            background: #333;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: #333;
        }

        .tab-btn.active {
            color: #333;
            border-bottom-color: #333;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Filters */
        .filters {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .filter-row:last-child {
            margin-bottom: 0;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 500;
            font-size: 0.95rem;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        input[type="text"] {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.95rem;
            flex: 1;
            min-width: 200px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #333;
        }

        select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.95rem;
            cursor: pointer;
            background: white;
        }

        select:focus {
            outline: none;
            border-color: #333;
        }

        .search-btn {
            padding: 8px 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .search-btn:hover {
            background: #555;
        }

        /* Pagination */
        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        .pagination-btn {
            padding: 6px 10px;
            background: white;
            border: 2px solid #ddd;
            color: #333;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f0f0f0;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-btn.active {
            background: #333;
            color: white;
            border-color: #333;
        }

        /* Contributions List */
        .contributions-container {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .page-count {
            color: #666;
            font-size: 0.95rem;
        }

        .contribution-item {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }

        .contribution-item:last-child {
            border-bottom: none;
        }

        .contribution-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            margin-bottom: 8px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .document-title {
            font-size: 1.05rem;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            word-break: break-word;
            flex-shrink: 1;
        }

        .document-title:hover {
            color: #0066cc;
        }

        .revision-tag {
            font-size: 0.9rem;
            font-weight: 400;
            color: #888;
            white-space: nowrap;
        }

        .size-change {
            font-weight: 700;
            font-size: 0.9rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .size-change.positive {
            color: #28a745;
        }

        .size-change.negative {
            color: #dc3545;
        }

        .size-change.neutral {
            color: #666;
        }

        .header-right {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .action-link {
            padding: 5px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #333;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .action-link:hover {
            background: #f0f0f0;
            border-color: #333;
        }

        .action-link.page-link {
            background: #e8f4f8;
            border-color: #b3d9e8;
            color: #0066cc;
            font-weight: 600;
        }

        .action-link.page-link:hover {
            background: #d0e8f2;
            border-color: #0066cc;
        }

        .action-link.disabled {
            background: #f9f9f9;
            color: #ccc;
            border-color: #eee;
            cursor: not-allowed;
            pointer-events: none;
        }

        .timestamp {
            font-size: 0.85rem;
            color: #999;
            margin-left: auto;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .comment {
            margin-top: 8px;
            padding: 10px 12px;
            background: #f8f8f8;
            border-left: 3px solid #333;
            font-size: 0.9rem;
            color: #555;
            word-break: break-all;
        }

        .comment i {
            font-style: italic;
            color: #888;
        }

        /* Statistics */
        .stats-content {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 25px;
        }

        .stats-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
        }

        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            min-width: 35px;
        }

        .rank-number.top1 {
            color: #ffd700;
        }

        .rank-number.top2 {
            color: #c0c0c0;
        }

        .rank-number.top3 {
            color: #cd7f32;
        }

        .rank-doc-name {
            flex: 1;
            font-weight: 600;
            color: #333;
            word-break: break-word;
            transition: all 0.2s;
        }
        
        .rank-doc-name:hover {
            color: #0066cc;
            text-decoration: underline;
        }

        .rank-count {
            font-size: 1.1rem;
            font-weight: 700;
            color: #666;
            white-space: nowrap;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .contribution-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-left {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                width: 100%;
            }

            .header-right {
                width: 100%;
            }

            .timestamp {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>공범 추적기</h1>
            <p class="subtitle">Gongbum Tracker</p>
        </header>

        <div id="userSelector">
            <h2 style="margin-bottom: 20px; text-align: center;">조사할 계정을 선택하세요</h2>
            <div id="userList" class="user-selection">
                </div>
        </div>

        <div id="mainContent" class="hidden">
            <button class="back-btn" onclick="goBack()">← 계정 선택으로 돌아가기</button>
            
            <div id="statsBar" class="stats-bar">
                <div class="stat-card">
                    <div class="stat-label">사용자</div>
                    <div class="stat-value" id="username">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">총 페이지</div>
                    <div class="stat-value" id="totalPages">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">총 기여</div>
                    <div class="stat-value" id="totalContributions">0</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="contributions">기여 내역</button>
                <button class="tab-btn" data-tab="statistics">통계</button>
            </div>

            <div id="contributionsTab" class="tab-content active">
                <div class="filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <input type="checkbox" id="commentOnlyFilter">
                            <label for="commentOnlyFilter">편집 요약만 보기 (시스템 자동 생성 제외)</label>
                        </div>
                    </div>
                    <div class="filter-row">
                        <input type="text" id="searchInput" placeholder="문서 검색...">
                        <select id="searchMode">
                            <option value="partial">부분 일치</option>
                            <option value="exact">정확히 일치</option>
                        </select>
                        <button class="search-btn" id="searchBtn">검색</button>
                        <button class="search-btn" id="clearBtn" style="background: #999;">초기화</button>
                    </div>
                </div>

                <div id="pagination" class="pagination"></div>
                <div id="contributionsContainer" class="contributions-container"></div>
            </div>

            <div id="statisticsTab" class="tab-content">
                <div class="stats-content">
                    <div id="statsPagination" class="pagination"></div>
                    <h2 class="stats-title">문서별 기여 횟수 랭킹</h2>
                    <ul id="rankingList" class="ranking-list"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let currentViewPage = 0;
        let filteredData = null;
        const ITEMS_PER_PAGE = 200;

        let statsSortedData = [];
        let currentStatsPage = 0;
        const STATS_PER_PAGE = 50;

        const userSelector = document.getElementById('userSelector');
        const userList = document.getElementById('userList');
        const mainContent = document.getElementById('mainContent');
        const pagination = document.getElementById('pagination');
        const contributionsContainer = document.getElementById('contributionsContainer');
        const commentOnlyFilter = document.getElementById('commentOnlyFilter');
        const searchInput = document.getElementById('searchInput');
        const searchMode = document.getElementById('searchMode');
        const searchBtn = document.getElementById('searchBtn');
        const clearBtn = document.getElementById('clearBtn');

        const systemPatterns = [
            /파일 .+을 올림 \(새 문서\)/g,
            /\(r\d+으로 되돌림\)/g,
            /\([^()]*에서 [^()]*으로 문서 이동\)/g,
            /\(새 문서\)/g,
            /자동 병합됨 \(r\d+\)/g,
			/\(삭제\)/g
        ];

        // 1. 초기 사용자 목록 로드
        async function loadUserList() {
            try {
                const response = await fetch('data/users.json');
                const users = await response.json();
                userList.innerHTML = '';
                users.forEach(user => {
                    const btn = document.createElement('button');
                    btn.className = 'user-btn';
                    btn.textContent = user;
                    btn.onclick = () => loadUserData(user);
                    userList.appendChild(btn);
                });
            } catch (error) {
                console.error('사용자 목록을 불러오는데 실패했습니다:', error);
                userList.innerHTML = '<p style="color:red; text-align:center; width:100%;">data/users.json 파일을 찾을 수 없습니다.</p>';
            }
        }

        // 2. 개별 사용자 데이터 로드
        async function loadUserData(username) {
            try {
                const response = await fetch(`data/${username}.json`);
                currentData = await response.json();
                
                userSelector.classList.add('hidden');
                mainContent.classList.remove('hidden');
                
                displayData();
            } catch (error) {
                alert(`계정(${username}) 데이터를 불러오는데 실패했습니다.`);
                console.error(error);
            }
        }

        // 3. 돌아오기 기능
        function goBack() {
            mainContent.classList.add('hidden');
            userSelector.classList.remove('hidden');
            currentData = null;
            // 필터 초기화
            searchInput.value = '';
            commentOnlyFilter.checked = false;
        }

        // 이후 기능은 기존 코드와 동일하게 유지
        function formatComment(comment) {
            if (!comment) return "";
            let formatted = comment;
            systemPatterns.forEach(pattern => {
                formatted = formatted.replace(pattern, (match) => `<i>${match}</i>`);
            });
            return formatted;
        }

        function isPureSystemComment(comment) {
            if (!comment) return true;
            let temp = comment;
            systemPatterns.forEach(pattern => {
                temp = temp.replace(pattern, "");
            });
            return temp.trim().length === 0;
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(tabName + 'Tab').classList.add('active');
            });
        });

        commentOnlyFilter.addEventListener('change', applyFilters);
        searchBtn.addEventListener('click', applyFilters);
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            commentOnlyFilter.checked = false;
            applyFilters();
        });

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') applyFilters();
        });

        function displayData() {
            if (!currentData) return;
            document.getElementById('username').textContent = currentData.username;
            document.getElementById('totalPages').textContent = currentData.total_pages;
            document.getElementById('totalContributions').textContent = currentData.total_contributions;
            applyFilters();
            generateStatistics();
        }

        function applyFilters() {
            if (!currentData) return;
            const commentOnly = commentOnlyFilter.checked;
            const searchTerm = searchInput.value.trim();
            const searchExact = searchMode.value === 'exact';
            let allContributions = [];
            currentData.pages.forEach(page => {
                page.contributions.forEach(contrib => {
                    let shouldInclude = true;
                    if (commentOnly && (!contrib.comment || isPureSystemComment(contrib.comment))) shouldInclude = false;
                    if (searchTerm && shouldInclude) {
                        if (searchExact) {
                            if (contrib.document_link !== searchTerm) shouldInclude = false;
                        } else {
                            if (!contrib.document_link.includes(searchTerm)) shouldInclude = false;
                        }
                    }
                    if (shouldInclude) {
                        allContributions.push({
                            ...contrib,
                            original_page_number: page.page_number,
                            original_page_url: page.url
                        });
                    }
                });
            });
            filteredData = { contributions: allContributions };
            currentViewPage = 0;
            renderPagination();
            showViewPage(0);
        }

        function renderPagination() {
            if (!filteredData || filteredData.contributions.length === 0) {
                pagination.innerHTML = '<div style="padding: 10px; color: #999;">검색 결과가 없습니다.</div>';
                return;
            }
            const totalItems = filteredData.contributions.length;
            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            const paginationHTML = createPaginationHTML(totalPages, currentViewPage, totalItems);
            pagination.innerHTML = paginationHTML;
        }

        function createPaginationHTML(totalPages, currentPage, totalItems) {
            let html = '';
            html += `<button class="pagination-btn" onclick="goToViewPage(0)" ${currentPage === 0 ? 'disabled' : ''}>≪</button>`;
            html += `<button class="pagination-btn" onclick="goToViewPage(${currentPage - 1})" ${currentPage === 0 ? 'disabled' : ''}>&lt;</button>`;
            const startPage = Math.max(0, currentPage - 4);
            const endPage = Math.min(totalPages - 1, currentPage + 4);
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="pagination-btn ${i === currentPage ? 'active' : ''}" onclick="goToViewPage(${i})">${i + 1}</button>`;
            }
            html += `<button class="pagination-btn" onclick="goToViewPage(${currentPage + 1})" ${currentPage === totalPages - 1 ? 'disabled' : ''}>&gt;</button>`;
            html += `<button class="pagination-btn" onclick="goToViewPage(${totalPages - 1})" ${currentPage === totalPages - 1 ? 'disabled' : ''}>≫</button>`;
            return html;
        }

        function goToViewPage(pageNum) {
            if (!filteredData) return;
            const totalPages = Math.ceil(filteredData.contributions.length / ITEMS_PER_PAGE);
            if (pageNum < 0 || pageNum >= totalPages) return;
            currentViewPage = pageNum;
            showViewPage(pageNum);
            renderPagination();
        }

        function showViewPage(pageNum) {
            if (!filteredData || filteredData.contributions.length === 0) {
                contributionsContainer.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">표시할 기여 내역이 없습니다.</div>';
                return;
            }
            const startIdx = pageNum * ITEMS_PER_PAGE;
            const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, filteredData.contributions.length);
            const pageContributions = filteredData.contributions.slice(startIdx, endIdx);
            contributionsContainer.innerHTML = `
                <div class="page-header">
                    <div class="page-title">기여 내역 (${startIdx + 1}-${endIdx}번째)</div>
                    <div class="page-count">${pageContributions.length}개 항목</div>
                </div>
            `;
            pageContributions.forEach(contrib => {
                contributionsContainer.appendChild(createContributionItem(contrib));
            });
        }

        function createContributionItem(contrib) {
            const div = document.createElement('div');
            div.className = 'contribution-item';
            const sizeChangeClass = contrib.size_change 
                ? (contrib.size_change.startsWith('+') ? 'positive' : 
                   contrib.size_change.startsWith('-') ? 'negative' : 'neutral')
                : 'neutral';
            const documentUrl = `https://namu.wiki/w/${encodeURIComponent(contrib.document_link)}`;
            const historyUrl = `https://namu.wiki/history/${encodeURIComponent(contrib.document_link)}`;
            const versionUrl = contrib.version_uuid ? `https://namu.wiki/w/${encodeURIComponent(contrib.document_link)}?uuid=${contrib.version_uuid}` : null;
            const hasDiff = contrib.diff_uuid && contrib.diff_uuid !== 'none';
            const diffUrl = hasDiff ? `https://namu.wiki/diff/${encodeURIComponent(contrib.document_link)}?uuid=${contrib.diff_uuid}` : '#';
            const formattedComment = formatComment(contrib.comment);

            div.innerHTML = `
                <div class="contribution-header">
                    <div class="header-left">
                        <a href="${documentUrl}" target="_blank" class="document-title">${contrib.document_link}</a>
                        ${contrib.version_revision ? `<span class="revision-tag">(${contrib.version_revision})</span>` : ''}
                        ${contrib.size_change ? `<span class="size-change ${sizeChangeClass}">${contrib.size_change}</span>` : ''}
                    </div>
                    <div class="header-right">
                        ${contrib.original_page_number && contrib.original_page_url ? `<a href="${contrib.original_page_url}" target="_blank" class="action-link page-link">${contrib.original_page_number} 페이지</a>` : ''}
                        <a href="${historyUrl}" target="_blank" class="action-link">역사</a>
                        ${versionUrl ? `<a href="${versionUrl}" target="_blank" class="action-link">버전</a>` : ''}
                        <a href="${diffUrl}" target="_blank" class="action-link ${hasDiff ? '' : 'disabled'}">비교</a>
                    </div>
                    <div class="timestamp">${contrib.timestamp || 'Unknown'}</div>
                </div>
                ${contrib.comment ? `<div class="comment">${formattedComment}</div>` : ''}
            `;
            return div;
        }

        function generateStatistics() {
            const docCounts = {};
            currentData.pages.forEach(page => {
                page.contributions.forEach(contrib => {
                    const docName = contrib.document_link;
                    docCounts[docName] = (docCounts[docName] || 0) + 1;
                });
            });
            statsSortedData = Object.entries(docCounts).sort((a, b) => b[1] - a[1]);
            currentStatsPage = 0;
            renderStatsPage(0);
        }

        function renderStatsPage(pageNum) {
            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = '';
            const startIdx = pageNum * STATS_PER_PAGE;
            const endIdx = Math.min(startIdx + STATS_PER_PAGE, statsSortedData.length);
            const pageData = statsSortedData.slice(startIdx, endIdx);
            pageData.forEach(([docName, count], index) => {
                const li = document.createElement('li');
                li.className = 'ranking-item';
                const rank = startIdx + index + 1;
                let rankClass = '';
                if (rank === 1) rankClass = 'top1';
                else if (rank === 2) rankClass = 'top2';
                else if (rank === 3) rankClass = 'top3';
                li.innerHTML = `
                    <div class="rank-number ${rankClass}">#${rank}</div>
                    <div class="rank-doc-name" style="cursor: pointer;" onclick="searchByKeyword('${docName.replace(/'/g, "\\'")}')">${docName}</div>
                    <div class="rank-count">${count}회</div>
                `;
                rankingList.appendChild(li);
            });
            renderStatsPagination();
        }

        function renderStatsPagination() {
            const paginationContainer = document.getElementById('statsPagination');
            const totalPages = Math.ceil(statsSortedData.length / STATS_PER_PAGE);
            let html = '';
            html += `<button class="pagination-btn" onclick="goToStatsPage(0)" ${currentStatsPage === 0 ? 'disabled' : ''}>≪</button>`;
            html += `<button class="pagination-btn" onclick="goToStatsPage(${currentStatsPage - 1})" ${currentStatsPage === 0 ? 'disabled' : ''}>&lt;</button>`;
            const start = Math.max(0, currentStatsPage - 4);
            const end = Math.min(totalPages - 1, currentStatsPage + 4);
            for (let i = start; i <= end; i++) {
                html += `<button class="pagination-btn ${i === currentStatsPage ? 'active' : ''}" onclick="goToStatsPage(${i})">${i + 1}</button>`;
            }
            html += `<button class="pagination-btn" onclick="goToStatsPage(${currentStatsPage + 1})" ${currentStatsPage === totalPages - 1 ? 'disabled' : ''}>&gt;</button>`;
            html += `<button class="pagination-btn" onclick="goToStatsPage(${totalPages - 1})" ${currentStatsPage === totalPages - 1 ? 'disabled' : ''}>≫</button>`;
            paginationContainer.innerHTML = html;
        }

        function goToStatsPage(pageNum) {
            const totalPages = Math.ceil(statsSortedData.length / STATS_PER_PAGE);
            if (pageNum < 0 || pageNum >= totalPages) return;
            currentStatsPage = pageNum;
            renderStatsPage(pageNum);
        }
        
        function searchByKeyword(keyword) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('[data-tab="contributions"]').classList.add('active');
            document.getElementById('contributionsTab').classList.add('active');
            searchInput.value = keyword;
            searchMode.value = 'exact';
            applyFilters();
        }

        // 초기 실행
        loadUserList();
    </script>
</body>
</html>
